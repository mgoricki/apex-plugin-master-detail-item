/*
* Plugin:  Advanced Slider
* Version: 1.0.0 (07.03.2017.)
*
* Author:  Marko Goricki, BiLog
* Mail:    mgoricki@gmail.com
* Twitter: @mgoricki
* Blog:    apexbyg.blogspot.com
*
* Depends:
*    apex/debug.js
*    apex/item.js
*
* Changes:
*
* v.1.0.0 - 20121116 - check if region is in tabbed region
* v.1.0.1 - 20140311 - heck IR class fix
* v.2.0.0 - 20160404 - ready for APEX 5
* v.2.0.1 - 20171115 - ceanup for apex.world
*
* Public Methods:
*
*   Get Options
*   $('#P6_DEPTNO').master_detail_item('option');
*
*   Get Selected Row Data
*   $('#P6_DEPTNO').master_detail_item('getSelectedRowData');
*
* Notes:
*   - for Interactive Report always set Static ID for MASTER_ID columns, also disable column hide
*
*/
!function(e){e.widget("ui.master_detail_item",{options:{itemName:null,mrIdVal:null,drIdVal:null,compPk:null,compPkItems:null,triggerClickOnLoad:null,mrMasterColl:"td[headers=MASTER_ID]",rowSelectedCSSClass:"row-selected",irRepSelector:".a-IRR-tableContainer .a-IRR-table tbody tr",irRepClass:".a-IRR-table",classicRepSelector:".t-Report-report tbody tr",valueSplitter:"#"},_privateStorage:function(){var e=this;e._vals={itemName:null,currentVal:"",isIR:!1,lastTriggered:null},e._obj={$item:null,$mr:null,$dr:null,$mrDriver:null,$drDriver:null}},_d:function(e,r){r?apex.debug.log("MDI plugin","["+r+"] :",e):apex.debug.log("MDI plugin:",e)},_e:function(e){apex.debug.error(e)},_clickOnFirstRow:function(){var e=this;e._d("Master Detail plugin - fire on page load = "+e.options.triggerClickOnLoad),"Y"==e.options.triggerClickOnLoad&&(e._d("...fire on page load - hide region #"+e._obj.$dr.attr("id")),e._vals.isIR?(e._d("...is IR"),e._obj.$mrDriverLive.parent().find("tr:nth-child(2)").trigger("click")):(e._d("...is not IR"),e._obj.$mrDriverLive.parent().find("tr:nth-child(1)").trigger("click")))},_fixHeader:function(){var r=this,t=r._obj.$mr.find(".a-IRR-table tbody th#MASTER_ID").index();r._obj.$mr.find(".a-IRR-tableContainer .a-IRR-table tbody tr:nth-child(1) th:nth-child("+(parseInt(t)+1)+")").css("display","none"),e(window).trigger("apexwindowresized"),r._vals.isIR?r._obj.$mrDriverLive=r._obj.$mr.find(r.options.irRepSelector):r._obj.$mrDriverLive=r._obj.$mr.find(r.options.classicRepSelector),r._obj.$mrDriverLive.each(function(){"tbody"==e(this).parent().get(0).localName&&e(this).css("cursor","pointer")})},_checkMasterReport:function(r){var t=this,a=!0,i=!1,o=!1;return t._d("start","checkMasterReport"),i=0==e("body").find(t._obj.$mr).length,o=0==e("body").find(t._obj.$dr).length,(i||o)&&(i&&t._e("no master report "+t.options.mrIdVal+" on page "),o&&t._e("no detail report "+t.options.drIdVal+" on page ")),r&&void 0!==r&&(0==r.find(t.options.mrMasterColl).length&&(t._vals.isIR?t._e("No "+t.options.mrMasterColl+" column. For IR set Static ID property to MASTER_ID."):t._e("No "+t.options.mrMasterColl+" column"),a=!1),r.hasClass("row-selected")&&(t._d("Master row already selected"),a=!1)),t._d("end","checkMasterReport, response = "+a),a},_setCurrentValue:function(e){var r=this;e.parent().find("tr."+r.options.rowSelectedCSSClass).removeClass(r.options.rowSelectedCSSClass),e.addClass(r.options.rowSelectedCSSClass),r._vals.currentVal=e.find(r.options.mrMasterColl).text(),0==r._vals.currentVal.length&&r._d("Master-detail Item - row value is null")},_getJsonData:function(r){var t=this,a="{",i="";return r.children().each(function(){var r=e(this);i="",a+='"'+r.attr("headers")+'":"';var t;r.find("input").length>0?"hidden"==r.find("input").attr("type")?(t=r.html().replace(/"/g,"&quot;").replace(/\n/g," ").replace(/\\/g,"/").replace(/<input.*/,""),r.find("input[type=hidden]").each(function(){i+='"HIDDEN_'+e(this).attr("class")+'":"'+e(this).val().replace(/"/g,"&quot;").replace(/\n/g," ").replace(/\\/g,"/")+'",'})):t=r.find("input").val().replace(/"/g,"&quot;").replace(/\n/g," ").replace(/\\/g,"/"):t=r.find("select").length>0?r.find("select").val().replace(/"/g,"&quot;").replace(/\n/g,"<br>").replace(/\\/g,"/"):r.html().replace(/"/g,"&quot;").replace(/\n/g," ").replace(/\\/g,"/"),a+=i?t+'",'+i:t+'",'}),a=a.slice(0,-1)+"}",t._d(a),t._vals.rowData=jQuery.parseJSON(a),t._vals.rowData},getSelectedRowData:function(){return this._vals.rowData},_refreshDetail:function(){for(var r=this,t=r.options.drIdVal.split(","),a=0;a<t.length;++a)apex.region(t[a]).refresh(),r._vals.currentVal>0&&e("#"+t[a]).show()},_init:function(){var r=this,t=!1;r._privateStorage(),r._vals.itemName=r.options.itemName,r._obj.$item=e("#"+r._vals.itemName),r._obj.$mr=e("#"+r.options.mrIdVal),r._obj.$dr=e("#"+r.options.drIdVal),r._d("start","init"),r._d("..itemName = "+r._vals.itemName,"init"),r._d("..masterReportId = "+r.options.mrIdVal,"init"),r._d("..detailReportId = "+r.options.drIdVal,"init");for(var a=r.options.drIdVal.split(","),i=0;i<a.length;++i)a[i]="#"+a[i];r._obj.$dr=e(a.join(",")),t=r._checkMasterReport(),t&&(r._obj.$mr.find(r.options.irRepClass).length>0?(r._d("..master report is IR report","init"),r._obj.$mrDriver=r._obj.$mr.find(r.options.irRepSelector),r._vals.selector=r.options.irRepSelector,r._vals.isIR=!0):(r._d("..master report is not IR report","init"),r._obj.$mrDriver=r._obj.$mr.find(r.options.classicRepSelector),r._vals.selector=r.options.classicRepSelector),r._obj.$mrDriver.closest("tbody").addClass("masterDetailReport"),r._obj.$mr.on("click",r._vals.selector,function(a){r._d("start","master.rowclick");var i=e(this);if((t=r._checkMasterReport(i))&&(r._setCurrentValue(i),r._vals.currentVal.length>0)){if(apex.debug("Master Detail plugin   ....row value = "+r._vals.currentVal),"N"==r.options.compPk)$s(r._vals.itemName,r._vals.currentVal);else{var o=r._vals.currentVal.split(r.options.valueSplitter),s=1;$s(r._vals.itemName,o[0]),e.each(r.options.compPkItems.split(","),function(){$s(e("#"+this)[0],o[s]),s++})}var l=r._getJsonData(i);r._refreshDetail(),r._obj.$item.trigger("masterdetailrowclick",l)}r._d("end","master.rowclick")}),r._obj.$mr.bind("apexbeforerefresh",function(){r._d("start","master.apexbeforerefresh"),r._obj.$dr.hide(),r._d("end","master.apexbeforerefresh")}),r._obj.$mr.bind("apexrefresh",function(e){r._d("start","master.apexrefresh"),r._vals.lastTriggered="MASTER",r._d("end","master.apexrefresh")}),r._obj.$mr.on("apexafterrefresh",function(){if(r._d("start","master.apexafterrefresh"),r._fixHeader(),0==r._obj.$mrDriverLive.length){if(r._d("no data found, reset MASTER_ID","master.apexafterrefresh"),r._vals.currentVal="",r._vals.rowData="",$s(r._vals.itemName,""),"Y"==r.options.compPk){var t=1;e.each(r.options.compPkItems.split(","),function(){$s(e("#"+this)[0],""),t++})}r._refreshDetail()}else"Y"==r.options.triggerClickOnLoad?(r._d("click on first row","master.apexafterrefresh"),r._clickOnFirstRow()):""!==r._obj.$item.val()?(r._d("select row","master.apexafterrefresh"),r._obj.$mrDriverLive.parent().find('td[headers="MASTER_ID"]').filter(function(){return e(this).text()===r._obj.$item.val()}).closest("tr").trigger("click")):(r._d("hide detail","master.apexafterrefresh"),r._obj.$dr.hide(),r._obj.$mr.trigger("MasterDetailNotClicked"));r._obj.$mr.trigger("MasterAfterRefreshEnd"),r._d("end","master.apexafterrefresh")}),r._obj.$dr.on("apexbeforerefresh",function(){r._d("start","detail.apexbeforerefresh"),r._vals.currentVal&&e(this).show(),r._d("end","detail.apexbeforerefresh")}),r._obj.$dr.bind("apexrefresh",function(){r._d("start","detail.apexrefresh"),r._vals.lastTriggered="DETAIL",r._d("end","detail.apexrefresh")}),e(function(){r._obj.$dr.hide(),r._fixHeader(),r._clickOnFirstRow(),r._obj.$mr.trigger("MasterDetailOnLoadEnd"),apex.debug("... MasterDetailOnLoadEnd triggered on #"+r._obj.$mr.attr("id"))})),r._obj.$mr.trigger("MasterDetailInitEnd"),apex.debug("... MasterDetailInitEnd triggered on #"+r._obj.$mr.attr("id")),apex.debug("Master Detail plugin - init end")}})}(apex.jQuery);
//# sourceMappingURL=hr_bilog_mgoricki_master_detail_2.0.1.min.js.map
